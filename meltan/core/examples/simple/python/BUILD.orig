load("//third_party/meltan/core:meltan.bzl", "meltan_test_pkg")

licenses(["notice"])

package(default_visibility = [
    "//third_party/meltan:__subpackages__",
])

py_binary(
    name = "simple",
    srcs = ["simple.py"],
    python_version = "PY3",
    visibility = ["//visibility:public"],
    deps = [
        "//google/protobuf:struct_py_pb2",
        "//net/proto2/python/public",
        "//net/proto2/python/public:use_pure_python",  # fixdeps: keep go/proto_python_default
        "//third_party/meltan/core/examples/simple:params_py_pb2",
        "//third_party/meltan/core/hwinterface:cpu_py_pb2",
        # copybara:strip_begin(Not yet open-sourced)
        "//third_party/meltan/core/hwinterface:service_py_pb2",
        "//third_party/meltan/core/hwinterface/client/python:service_client",
        # copybara:strip_end
        "//third_party/meltan/lib/params:utils_py",
        "//third_party/meltan/lib/results:results_py_pb2",
        "//third_party/meltan/lib/results/python:results",
        "//third_party/py/absl:app",
        "//third_party/pybind11_abseil:status",
    ],
)

meltan_test_pkg(
    name = "simple_py",
    binary = ":simple",
    json_defaults = "//third_party/meltan/core/examples/simple:params.json",
    params_proto = "//third_party/meltan/core/examples/simple:params_proto",
)

# copybara:strip_begin(g3 only)
genmpm(
    name = "simple_py_mpm",
    package_name = "platforms/testing/tests/meltan/simple_py",
    deps = [":simple_py"],
)
# copybara:strip_end
